/**!
 * audioMotion-analyzer
 * High-resolution real-time graphic audio spectrum analyzer JS module
 *
 * @version 3.6.0
 * @author  Henrique Avila Vianna <hvianna@gmail.com> <https://henriquevianna.com>
 * @license AGPL-3.0-or-later
 */const dt="3.6.0",Y=2*Math.PI,J=Math.PI/2,ft=Y/3600,lt=2**(1/24),ut=440*lt**-114;class gt{constructor(e,t={}){this._ready=!1,this._gradients={classic:{bgColor:"#111",colorStops:["hsl( 0, 100%, 50% )",{pos:.6,color:"hsl( 60, 100%, 50% )"},"hsl( 120, 100%, 50% )"]},prism:{bgColor:"#111",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 50% )","hsl( 240, 100%, 50% )"]},rainbow:{bgColor:"#111",dir:"h",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 47% )","hsl( 240, 100%, 58% )","hsl( 300, 100%, 50% )","hsl( 360, 100%, 50% )"]}},this._container=e||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270;let i;if(!(t.source&&(i=t.source.context))){if(!(i=t.audioCtx))try{i=new(window.AudioContext||window.webkitAudioContext)}catch{throw new z("ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?")}}if(!i.createGain)throw new z("ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid");const s=this._analyzer=[i.createAnalyser(),i.createAnalyser()],c=this._splitter=i.createChannelSplitter(2),a=this._merger=i.createChannelMerger(2);this._input=i.createGain(),this._output=i.createGain(),this._sources=[],t.source&&this.connectInput(t.source);for(const r of[0,1])c.connect(s[r],r);a.connect(this._output),this._outNodes=[],t.connectSpeakers!==!1&&this.connectOutput(),this._energy={val:0,peak:0,hold:0};const n=document.createElement("canvas");n.style="max-width: 100%;",this._canvasCtx=n.getContext("2d");for(const r of["_scaleX","_scaleR"])this[r]=document.createElement("canvas").getContext("2d");this._fsEl=t.fsElement||n;const l=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout(()=>{this._fsChanging||(this._setCanvas("resize"),this._fsTimeout=0)},60))};window.ResizeObserver&&new ResizeObserver(l).observe(this._container),window.addEventListener("resize",l),n.addEventListener("fullscreenchange",()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas("fschange"),this._fsTimeout=window.setTimeout(()=>{this._fsChanging=!1,this._fsTimeout=0},60)});const d=()=>{i.state=="suspended"&&i.resume(),window.removeEventListener("click",d)};window.addEventListener("click",d),this._calcAux(),this._setProps(t,!0),this.useCanvas&&this._container.appendChild(n),this._ready=!0,this._setCanvas("create")}get alphaBars(){return this._alphaBars}set alphaBars(e){this._alphaBars=!!e,this._calcAux()}get barSpace(){return this._barSpace}set barSpace(e){this._barSpace=+e||0,this._calcAux()}get fftSize(){return this._analyzer[0].fftSize}set fftSize(e){for(const i of[0,1])this._analyzer[i].fftSize=e;const t=this._analyzer[0].frequencyBinCount;this._fftData=[new Uint8Array(t),new Uint8Array(t)],this._calcBars()}get gradient(){return this._gradient}set gradient(e){if(!this._gradients.hasOwnProperty(e))throw new z("ERR_UNKNOWN_GRADIENT",`Unknown gradient: '${e}'`);this._gradient=e,this._makeGrad()}get height(){return this._height}set height(e){this._height=e,this._setCanvas("user")}get ledBars(){return this._showLeds}set ledBars(e){this._showLeds=!!e,this._calcAux()}get loRes(){return this._loRes}set loRes(e){this._loRes=!!e,this._setCanvas("lores")}get lumiBars(){return this._lumiBars}set lumiBars(e){this._lumiBars=!!e,this._calcAux(),this._calcLeds(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(e){for(const t of[0,1])this._analyzer[t].maxDecibels=e}get maxFreq(){return this._maxFreq}set maxFreq(e){if(e<1)throw new z("ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1");this._maxFreq=e,this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(e){for(const t of[0,1])this._analyzer[t].minDecibels=e}get minFreq(){return this._minFreq}set minFreq(e){if(e<1)throw new z("ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1");this._minFreq=e,this._calcBars()}get mirror(){return this._mirror}set mirror(e){this._mirror=Math.sign(e)|0,this._calcAux(),this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(e){const t=e|0;if(t>=0&&t<=10&&t!=9)this._mode=t,this._calcAux(),this._calcBars(),this._makeGrad();else throw new z("ERR_INVALID_MODE",`Invalid mode: ${e}`)}get outlineBars(){return this._outlineBars}set outlineBars(e){this._outlineBars=!!e,this._calcAux()}get radial(){return this._radial}set radial(e){this._radial=!!e,this._calcAux(),this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(e){if(e=+e||0,e<0||e>=1)throw new z("ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1");this._reflexRatio=e,this._calcAux(),this._makeGrad(),this._calcLeds()}get showLeds(){return this.ledBars}set showLeds(e){this.ledBars=e}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(e){for(const t of[0,1])this._analyzer[t].smoothingTimeConstant=e}get spinSpeed(){return this._spinSpeed}set spinSpeed(e){e=+e||0,(this._spinSpeed===void 0||e==0)&&(this._spinAngle=-J),this._spinSpeed=e}get splitGradient(){return this._splitGradient}set splitGradient(e){this._splitGradient=!!e,this._makeGrad()}get stereo(){return this._stereo}set stereo(e){this._stereo=!!e,this._input.disconnect(),this._input.connect(this._stereo?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._stereo?this._merger:this._output),this._calcAux(),this._createScales(),this._calcLeds(),this._makeGrad()}get volume(){return this._output.gain.value}set volume(e){this._output.gain.value=e}get width(){return this._width}set width(e){this._width=e,this._setCanvas("user")}get audioCtx(){return this._input.context}get canvas(){return this._canvasCtx.canvas}get canvasCtx(){return this._canvasCtx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get energy(){return this.getEnergy()}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._isAlphaBars}get isFullscreen(){return(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._isLedDisplay}get isLedDisplay(){return this.isLedBars}get isLumiBars(){return this._isLumiBars}get isOctaveBands(){return this._isOctaveBands}get isOn(){return this._runId!==void 0}get isOutlineBars(){return this._isOutline}get peakEnergy(){return this.getEnergy("peak")}get pixelRatio(){return this._pixelRatio}static get version(){return dt}connectInput(e){const t=e instanceof HTMLMediaElement;if(!(t||e.connect))throw new z("ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode");const i=t?this.audioCtx.createMediaElementSource(e):e;return this._sources.includes(i)||(i.connect(this._input),this._sources.push(i)),i}connectOutput(e=this.audioCtx.destination){if(!this._outNodes.includes(e)&&(this._output.connect(e),this._outNodes.push(e),this._outNodes.length==1))for(const t of[0,1])this._analyzer[t].connect(!this._stereo&&!t?this._output:this._merger,0,t)}disconnectInput(e){e?Array.isArray(e)||(e=[e]):e=Array.from(this._sources);for(const t of e){const i=this._sources.indexOf(t);i>=0&&(t.disconnect(this._input),this._sources.splice(i,1))}}disconnectOutput(e){if(!(e&&!this._outNodes.includes(e))&&(this._output.disconnect(e),this._outNodes=e?this._outNodes.filter(t=>t!==e):[],this._outNodes.length==0))for(const t of[0,1])this._analyzer[t].disconnect()}getBars(){return Array.from(this._bars,({posX:e,freqLo:t,freqHi:i,hold:s,peak:c,value:a})=>({posX:e,freqLo:t,freqHi:i,hold:s,peak:c,value:a}))}getEnergy(e,t){if(e===void 0)return this._energy.val;if(e!=+e){if(e=="peak")return this._energy.peak;const n={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!n[e])return null;[e,t]=n[e]}const i=this._freqToBin(e),s=t?this._freqToBin(t):i,c=this._stereo+1;let a=0;for(let n=0;n<c;n++)for(let l=i;l<=s;l++)a+=this._fftData[n][l];return a/(s-i+1)/c/255}registerGradient(e,t){if(typeof e!="string"||e.trim().length==0)throw new z("ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string");if(typeof t!="object")throw new z("ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object");if(t.colorStops===void 0||t.colorStops.length<2)throw new z("ERR_GRADIENT_MISSING_COLOR","Gradient must define at least two colors");this._gradients[e]={bgColor:t.bgColor||"#111",dir:t.dir,colorStops:t.colorStops},e==this._gradient&&this._makeGrad()}setCanvasSize(e,t){this._width=e,this._height=t,this._setCanvas("user")}setFreqRange(e,t){if(e<1||t<1)throw new z("ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1");this._minFreq=Math.min(e,t),this._maxFreq=Math.max(e,t),this._calcBars()}setLedParams(e){let t,i,s;e&&(t=e.maxLeds|0,i=+e.spaceV,s=+e.spaceH),this._ledParams=t>0&&i>0&&s>=0?[t,i,s]:void 0,this._calcLeds()}setOptions(e){this._setProps(e)}setSensitivity(e,t){for(const i of[0,1])this._analyzer[i].minDecibels=Math.min(e,t),this._analyzer[i].maxDecibels=Math.max(e,t)}toggleAnalyzer(e){const t=this.isOn;return e===void 0&&(e=!t),t&&!e?(cancelAnimationFrame(this._runId),this._runId=void 0):!t&&e&&(this._frame=this._fps=0,this._time=performance.now(),this._runId=requestAnimationFrame(i=>this._draw(i))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const e=this._fsEl;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}}_calcAux(){const e=this.canvas,t=this._radial,i=this._stereo&&!t,s=e.width>>1;this._radius=Math.min(e.width,e.height)*(this._stereo?.375:.125)|0,this._barSpacePx=Math.min(this._barWidth-1,this._barSpace>0&&this._barSpace<1?this._barWidth*this._barSpace:this._barSpace),this._isOctaveBands=this._mode%10!=0,this._isLedDisplay=this._showLeds&&this._isOctaveBands&&!t,this._isLumiBars=this._lumiBars&&this._isOctaveBands&&!t,this._isAlphaBars=this._alphaBars&&!this._isLumiBars&&this._mode!=10,this._isOutline=this._outlineBars&&this._isOctaveBands&&!this._isLumiBars&&!this._isLedDisplay,this._maximizeLeds=!this._stereo||this._reflexRatio>0&&!this._isLumiBars,this._channelHeight=e.height-(i&&!this._isLedDisplay?.5:0)>>i,this._analyzerHeight=this._channelHeight*(this._isLumiBars||t?1:1-this._reflexRatio)|0,this._channelGap=i?e.height-this._channelHeight*2:0,this._analyzerWidth=e.width-s*(this._mirror!=0),this._initialX=s*(this._mirror==-1&&!t)}_calcBars(){const e=this._bars=[];if(!this._ready)return;const t=r=>r*this.audioCtx.sampleRate/this.fftSize||1,i=(r,g,_,h,f,m,x)=>e.push({posX:r,binLo:g,binHi:_,freqLo:h,freqHi:f,ratioLo:m,ratioHi:x,peak:[0,0],hold:[0],value:[0]}),s=this._analyzerWidth,c=this._initialX,a=this._maxFreq,n=this._minFreq;let l,d;if(this._isOctaveBands){let r=[];for(let _=0;_<11;_++)for(let h=0;h<24;h++){const f=ut*lt**(_*24+h),m=this._freqToBin(f,"floor"),x=t(m),B=t(m+1),v=(f-x)/(B-x);r.push({freq:f,bin:m,ratio:v})}const g=[0,1,2,3,4,6,8,12,24][this._mode];for(let _=0;_<r.length;_+=g){let{freq:h,bin:f,ratio:m}=r[_],{freq:x,bin:B,ratio:v}=r[_+g-1];const S=e.length,p=e[S-1];if(x>a||B>=this.fftSize/2){p.binHi++,p.ratioHi=0,p.freqHi=t(p.binHi);break}if(h>=n){if(S>0){const b=f-p.binHi;b>1&&(p.binHi=f-(b>>1),p.ratioHi=0,p.freqHi=t(p.binHi),S>1&&p.binHi>p.binLo&&p.binLo>e[S-2].binHi&&(p.ratioLo=0,p.freqLo=t(p.binLo)),f=p.binHi+1),B>f&&f>p.binHi&&(m=0,h=t(f))}i(0,f,B,h,x,m,v)}}this._barWidth=s/e.length,e.forEach((_,h)=>_.posX=c+h*this._barWidth),l=Math.log10(e[0].freqLo),d=s/(Math.log10(e[e.length-1].freqHi)-l)}else{this._barWidth=1,l=Math.log10(n),d=s/(Math.log10(a)-l);const r=this._freqToBin(n,"floor"),g=this._freqToBin(a);let _=-999;for(let h=r;h<=g;h++){const f=t(h),m=c+Math.round(d*(Math.log10(f)-l));m>_?(i(m,h,h,f,f,0,0),_=m):e.length&&(e[e.length-1].binHi=h,e[e.length-1].freqHi=f)}}this._minLog=l,this._logWidth=d,this._calcAux(),this._createScales(),this._calcLeds()}_calcLeds(){if(!this._isOctaveBands||!this._ready)return;const e=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),t=[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]],i=this._ledParams,[s,c,a]=i||t[this._mode];let n,l,d=this._analyzerHeight;if(i){const r=2*e;let g;n=s+1;do n--,g=d/n/(1+c),l=g*c;while((g<r||l<r)&&n>1)}else{const r=540/c;l=Math.min(c*e,Math.max(2,d/r+.1|0))}this._maximizeLeds&&(d+=l),i||(n=Math.min(s,d/(l*2)|0)),this._leds=[n,a>=1?a:this._barWidth*a,l,d/n-l]}_createScales(){const e=[16,31,63,125,250,500,1e3,2e3,4e3,8e3,16e3],t=this._canvasCtx.canvas,i=this._scaleX,s=this._scaleR,c=i.canvas,a=s.canvas,n=Math.min(t.width,t.height)*.03|0;a.width=a.height=(this._radius<<1)+this._stereo*n;const l=a.width>>1,d=l-n*.7,r=(g,_)=>{const h=Y*(g/t.width),f=h-J,m=d*Math.cos(f),x=d*Math.sin(f);s.save(),s.translate(l+m,l+x),s.rotate(h),s.fillText(_,0,0),s.restore()};c.width|=0,i.fillStyle=s.strokeStyle="#000c",i.fillRect(0,0,c.width,c.height),s.arc(l,l,l-n/2,0,Y),s.lineWidth=n,s.stroke(),i.fillStyle=s.fillStyle="#fff",i.font=`${c.height>>1}px sans-serif`,s.font=`${n>>1}px sans-serif`,i.textAlign=s.textAlign="center";for(const g of e){const _=g>=1e3?`${g/1e3}k`:g,h=this._logWidth*(Math.log10(g)-this._minLog);h>=0&&h<=this._analyzerWidth&&(i.fillText(_,this._initialX+h,c.height*.75),h<this._analyzerWidth&&r(h,_),this._mirror&&(i.fillText(_,(this._initialX||t.width)-h,c.height*.75),h>10&&r(-h,_)))}}_draw(e){const t=this._canvasCtx,i=t.canvas,s=this._scaleX.canvas,c=this._scaleR.canvas,a=this._energy,n=this._mode,l=this._isAlphaBars,d=this._isLedDisplay,r=this._isLumiBars,g=this._isOctaveBands,_=this._isOutline,h=this._radial,f=this._stereo,m=+this.lineWidth,x=this._mirror,B=this._channelHeight,v=this._channelGap,S=this._analyzerHeight,p=h?i.width:this._analyzerWidth,b=this._initialX,G=b+p,H=i.width>>1,N=i.height>>1,U=this._radius,P=h?Math.min(H,N)-U:S,V=this.useCanvas;a.val>0&&(this._spinAngle+=this._spinSpeed*ft);const K=o=>{if(o&&m){const R=t.globalAlpha;t.globalAlpha=1,t.stroke(),t.globalAlpha=R}},M=(o,R,F)=>{const L=U+R,T=F*Y*(o/i.width)+this._spinAngle;return[H+L*Math.cos(T),N+L*Math.sin(T)]},Z=(o,R,F,L,T)=>{t.beginPath();for(const q of x?[1,-1]:[1])t.moveTo(...M(o,R,q)),t.lineTo(...M(o,R+L,q)),t.lineTo(...M(o+F,R+L,q)),t.lineTo(...M(o+F,R,q));K(T),t.fill()},[ct,tt,$,j]=this._leds||[],et=o=>(o*ct|0)*(j+$)-$,_t=!this.showBgColor||d&&!this.overlay?"#000":this._gradients[this._gradient].bgColor;let D=this._barWidth-(g?Math.max(d?tt:0,this._barSpacePx):0);this._barSpace==0&&!d&&(D|=0);let it=0;const st=this._bars.length;for(let o=0;o<f+1;o++){const R=B*o+v*o,F=R+B,L=R+S-(d&&!this._maximizeLeds?$:0);if(V){if(this.overlay&&t.clearRect(0,R-v,i.width,B+v),(!this.overlay||this.showBgColor)&&(this.overlay&&(t.globalAlpha=this.bgAlpha),t.fillStyle=_t,(!h||o==0)&&t.fillRect(b,R-v,p,(this.overlay&&this.reflexAlpha==1?S:B)+v),t.globalAlpha=1),this.showScaleY&&!r&&!h){const w=s.height,A=w>>1,W=this._analyzer[0].minDecibels,I=this._analyzer[0].maxDecibels,Q=S/(I-W);t.fillStyle="#888",t.font=`${A}px sans-serif`,t.textAlign="right",t.lineWidth=1;for(let O=I;O>W;O-=5){const u=R+(I-O)*Q,k=O%2==0|0;if(k){const y=u+A*(u==R?.8:.35);x!=-1&&t.fillText(O,w*.85,y),x!=1&&t.fillText(O,i.width-w*.1,y),t.strokeStyle="#888",t.setLineDash([2,4]),t.lineDashOffset=0}else t.strokeStyle="#555",t.setLineDash([2,8]),t.lineDashOffset=1;t.beginPath(),t.moveTo(b+w*k*(x!=-1),~~u+.5),t.lineTo(G-w*k*(x!=1),~~u+.5),t.stroke()}t.setLineDash([]),t.lineDashOffset=0}d?(t.setLineDash([j,$]),t.lineWidth=D):t.lineWidth=_?Math.min(m,D/2):m,t.fillStyle=t.strokeStyle=this._canvasGradient}const T=this._fftData[o];this._analyzer[o].getByteFrequencyData(T);const q=(w,A)=>T[w]+(T[w+1]-T[w])*A;t.beginPath();let ht=[];for(let w=0;w<st;w++){const A=this._bars[w],{binLo:W,binHi:I,ratioLo:Q,ratioHi:O}=A;let u=Math.max(q(W,Q),q(I,O));for(let C=W+1;C<I;C++)T[C]>u&&(u=T[C]);if(u/=255,A.value[o]=u,it+=u,A.peak[o]>0&&(A.hold[o]--,A.hold[o]<0&&(A.peak[o]+=A.hold[o]/P)),u>=A.peak[o]&&(A.peak[o]=u,A.hold[o]=30),!V)continue;r||l?t.globalAlpha=u:_&&(t.globalAlpha=this.fillAlpha),d?(u=et(u),u<0&&(u=0)):u=u*P|0,h&&o==1&&(u*=-1);let k=D,y=A.posX;if(n==10){const C=w?0:(T[this._bars[1].binLo]/255*P*(!h||!o||-1)+u)/2;if(h){if(w==0&&t.lineTo(...M(0,y<0?C:u,1)),y>=0){const E=[y,u];t.lineTo(...M(...E,1)),ht.push(E)}}else{if(w==0)if(x!=-1){const E=W?T[W-1]/255*P:u;t.moveTo(b-m,L-E)}else t.moveTo(b,L-(y<b?C:u));(x!=-1||y>=b)&&t.lineTo(y,L-u)}}else if(n>0&&(d?y+=Math.max(tt/2,this._barSpacePx/2):this._barSpace==0?(y|=0,w>0&&y>this._bars[w-1].posX+D&&(y--,k++)):y+=this._barSpacePx/2),d){const C=y+D/2;if(this.showBgColor&&!this.overlay){const E=t.globalAlpha;t.beginPath(),t.moveTo(C,R),t.lineTo(C,L),t.strokeStyle="#7f7f7f22",t.globalAlpha=1,t.stroke(),t.strokeStyle=t.fillStyle,t.globalAlpha=E}t.beginPath(),t.moveTo(C,r?R:L),t.lineTo(C,r?F:L-u),t.stroke()}else if(y>=b)if(h)Z(y,0,k,u,_);else{const C=y,E=r?R:L,nt=k,rt=r?F:-u;t.beginPath(),t.moveTo(C,E),t.lineTo(C,E+rt),t.lineTo(C+nt,E+rt),t.lineTo(C+nt,E),K(_),t.fill()}const X=A.peak[o];X>0&&this.showPeaks&&!r&&y>=b&&y<G&&(_&&m>0?t.globalAlpha=1:l&&(t.globalAlpha=X),d?t.fillRect(y,L-et(X),D,j):h?n!=10&&Z(y,X*P*(!o||-1),k,-2):t.fillRect(y,L-X*P,k,2))}if(!!V){if(t.globalAlpha=1,n==10){if(h){if(x){let w;for(;w=ht.pop();)t.lineTo(...M(...w,-1))}t.closePath()}m>0&&t.stroke(),this.fillAlpha>0&&(h?(t.moveTo(H+U,N),t.arc(H,N,U,0,Y,!0)):(t.lineTo(G,L),t.lineTo(b,L)),t.globalAlpha=this.fillAlpha,t.fill(),t.globalAlpha=1)}if(this._reflexRatio>0&&!r){let w,A;this.reflexFit||f?(w=f&&o==0?B+v:0,A=B-S):(w=i.height-S*2,A=S),t.globalAlpha=this.reflexAlpha,this.reflexBright!=1&&(t.filter=`brightness(${this.reflexBright})`),t.setTransform(1,0,0,-1,0,i.height),t.drawImage(i,0,R,i.width,S,0,w,i.width,A),t.setTransform(1,0,0,1,0,0),t.filter="none",t.globalAlpha=1}}}a.val=it/(st<<f),a.val>=a.peak?(a.peak=a.val,a.hold=30):a.hold>0?a.hold--:a.peak>0&&(a.peak*=(30+a.hold--)/30),V&&(x&&!h&&(t.setTransform(-1,0,0,1,i.width-b,0),t.drawImage(i,b,0,H,i.height,0,0,H,i.height),t.setTransform(1,0,0,1,0,0)),t.setLineDash([]),this.showScaleX&&(h?(t.save(),t.translate(H,N),this._spinSpeed&&t.rotate(this._spinAngle+J),t.drawImage(c,-c.width>>1,-c.width>>1),t.restore()):t.drawImage(s,0,i.height-s.height))),this._frame++;const at=e-this._time;if(at>=1e3&&(this._fps=this._frame/(at/1e3),this._frame=0,this._time=e),this.showFPS){const o=s.height;t.font=`bold ${o}px sans-serif`,t.fillStyle="#0f0",t.textAlign="right",t.fillText(Math.round(this._fps),i.width-o,o*2)}this.onCanvasDraw&&(t.save(),t.fillStyle=t.strokeStyle=this._canvasGradient,this.onCanvasDraw(this),t.restore()),this._runId=requestAnimationFrame(o=>this._draw(o))}_freqToBin(e,t="round"){const i=this._analyzer[0].frequencyBinCount-1,s=Math[t](e*this.fftSize/this.audioCtx.sampleRate);return s<i?s:i}_makeGrad(){if(!this._ready)return;const e=this._canvasCtx,t=e.canvas,i=this._isLumiBars,s=i?t.height:t.height*(1-this._reflexRatio*!this._stereo)|0,c=1-this._reflexRatio,a=this._initialX,n=t.width>>1,l=t.height>>1,d=Math.min(n,l),r=this._radius,g=this._gradients[this._gradient],_=g.colorStops,h=g.dir=="h";let f;if(this._radial?f=e.createRadialGradient(n,l,d,n,l,r-(d-r)*this._stereo):f=e.createLinearGradient(...h?[a,0,a+this._analyzerWidth,0]:[0,0,0,s]),_){const m=this._stereo&&!this._splitGradient&&!h,x=(B,v)=>f.addColorStop(B,v.color||v);for(let B=0;B<1+m;B++)_.forEach((v,S)=>{const p=_.length-1;let b=v.pos!==void 0?v.pos:S/p;if(m&&(b/=2),this._stereo&&!i&&!this._radial&&!h&&(b*=c,!m&&b>.5*c&&(b+=.5*this._reflexRatio)),B==1)if(this._radial||i){const G=p-S;v=_[G],b=1-(v.pos!==void 0?v.pos:G/p)/2}else S==0&&b>0&&x(.5,v),b+=.5;x(b,v),this._stereo&&S==p&&b<.5&&x(.5,v)})}this._canvasGradient=f}_setCanvas(e){if(!this._ready)return;const t=this._canvasCtx,i=t.canvas,s=this._scaleX.canvas,c=window.devicePixelRatio/(this._loRes+1);let a=window.screen.width*c,n=window.screen.height*c;Math.abs(window.orientation)==90&&a<n&&([a,n]=[n,a]);const l=this.isFullscreen,d=l&&this._fsEl==i,r=d?a:(this._width||this._container.clientWidth||this._defaultWidth)*c|0,g=d?n:(this._height||this._container.clientHeight||this._defaultHeight)*c|0;this._pixelRatio=c,this._fsWidth=a,this._fsHeight=n,!(i.width==r&&i.height==g)&&(i.width=r,i.height=g,this._calcAux(),this.overlay||(t.fillStyle="#000",t.fillRect(0,0,r,g)),t.lineJoin="bevel",s.width=r,s.height=Math.max(20*c,Math.min(r,g)/27|0),this._makeGrad(),this._calcBars(),this._fsStatus!==void 0&&this._fsStatus!==l&&(e="fschange"),this._fsStatus=l,this.onCanvasResize&&this.onCanvasResize(e,this))}_setProps(e,t){const i={alphaBars:!1,barSpace:.1,bgAlpha:.7,fftSize:8192,fillAlpha:1,gradient:"classic",ledBars:!1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,outlineBars:!1,overlay:!1,radial:!1,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,stereo:!1,useCanvas:!0,volume:1},s=["onCanvasDraw","onCanvasResize"],c=Object.keys(i).filter(a=>a!="start").concat(s,["height","width"]);e&&e.showLeds!==void 0&&e.ledBars===void 0&&(e.ledBars=e.showLeds),(t||e===void 0)&&(e={...i,...e});for(const a of Object.keys(e))s.includes(a)&&typeof e[a]!="function"?this[a]=void 0:c.includes(a)&&(this[a]=e[a]);e.start!==void 0&&this.toggleAnalyzer(e.start)}}class z extends Error{constructor(e,t){super(t),this.name="AudioMotionError",this.code=e}}export{gt as A};
